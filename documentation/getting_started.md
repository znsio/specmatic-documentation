---
layout: default
title: Getting Started
parent: Documentation
nav_order: 1
---
Quick Start
===========

Command Line
------------

Qontract can run as a standalone Jar also. This mode helps leverage the tool in language / platform agnostic manner. Say suppose you have a Python provider and a Ruby consumer you can still leverage the tool (even though the tool itself is written in Kotlin and needs only JVM to run).

Refer to [command line setup](/documentation/setup_command_line.html) page.

### Author a contract

Copy paste below text into a file with name "service.qontract". This as you can see uses the Gherkin syntax to describe a basic GET request. 

    Feature: Contract for the petstore service

    Scenario: Should be able to get a pet by petId url parameter
      When GET /pets/(petid:number)
      Then status 200
      And response-body {petid: "(number)"}

There are some extra keywords that make it easier to define APIs.
* GET and related URL
* status
* response-body
* (number) - placeholder for number datatype

These keywords are documented in the contract syntax reference. TODO

### Stub server

All you need at this point is the above qontract file and the jar file which you built (and optionally aliased). You can spin up a stuck server with these two ingredients.

    qontract stub --path=".. ../petstore/qontract/service.qontract" \
                    --host="localhost" \
                    --port="8000" \
               start

The command has defaults and necessary help to guide you through.

Once the stub server is running you can verify the API by accessing it through Postmane, Chrome, Curl etc. to see the response.

    curl http://localhost:8000/pets/123

The response will contain some auto-generate value that adhere to the datatypes defined in the contract. At this point you are ready to start consumer development with this stub server.

### Contract as a Test

Now lets start building the provider. Say suppose you have an empty provider API running at port 8000, we just need to point the contract as test command to it.

    qontract test --path=".. ../petstore/contract/service.qontract" \
                            --host="localhost" \
                            --port="8000" \
               run

This command will give a xunit like feedback about each scenario and what parts of the contract your provider is not satisfying.

    Tests run: 1, Failures: 0, Errors: 0
    Failed Interactions
    ===================
    Scenario: GET /pets/(petid:number) Error:
    	Response did not match
    	JSON object did not match Expected: {petid=12345} Actual: {petid=210}

As you can see it has rightly pointed out that we have not implemented the "/pets" endpoint. Once you build it the errors will disappear.
This is quite similar to how we start with a feature file in BDD and then let it drive development.

Note: The petid "12345" is generated by qontract in above example. If you would like to control the value that is being generated please refer to [suggestions](/documentation/suggestions.html).

Programmatic Implementation
---------------------------

If you are building your application in Java, Kotlin (TODO other JVM languages that may just work), you are in luck, because you can spawn the stub server or run the contract as test programmatically.

### Consumer - Leveraging Mock Server

TODO: Stub vs Mock explanation

Let us try building a Pet Store Consumer through Test First appraoch.

Add jar dependency.

```
<dependency>
    <groupId>run.qontract</groupId>
    <artifactId>qontract-core</artifactId>
    <version>0.0.1</version>
</dependency>
```

```java
public class PetStoreConsumerTest {
    private static ContractMock petStoreMock;

    @BeforeAll
    public static void setup() throws Throwable {
        //Start a mock server based on the contract
        String gherkin = Utilities.readFile("<baseDir>/petstore/qontract/service.qontract");
        petStoreMock = ContractMock.fromGherkin(gherkin, 9003);
        petStoreMock.start();
    }

    @Test
    public void shouldGetPetByPetId() throws IOException {
        //Arrange - Setup the mock to respond to the request we expect PetStoreConsumer to make
        HttpRequest httpRequest = new HttpRequest().setMethod("GET").updatePath("/pets/123");
        HttpResponse httpResponse = HttpResponse.Companion.jsonResponse("{petid:123}");
        Map<String, Object> serverState = new HashMap<>();
        // This line makes sure the request and response we are setting up are in line with the contract
        petStoreMock.tryToMockExpectation(new MockScenario(httpRequest, httpResponse, serverState));

        //Act
        PetStoreConsumer petStoreConsumer = new PetStoreConsumer("http://localhost:9003");
        Pet pet = petStoreConsumer.getPet(123);

        //Assert
        Assert.assertEquals(123, pet.getPetid());
    }

    @AfterAll
    public static void tearDown() {
        petStoreMock.close();
    }
}
```

The test injects mock pet store service url to the PetStoreConsumer. Let us now look at how the PetStoreConsumer and Pet code looks.

```java
public class PetStoreConsumer {
    private String petStoreUrl;

    public PetStoreConsumer(String petStoreUrl) {
        this.petStoreUrl = petStoreUrl;
    }

    public Pet getPet(int petId) {
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<Pet> response = restTemplate.exchange(URI.create(petStoreUrl + "/pets/" + petId), HttpMethod.GET, null, Pet.class);
        return response.getBody();
    }
}

public class Pet {
    private int petid;

    public void setPetid(int id) {
        this.petid = id;
    }

    public int getPetid() {
        return this.petid;
    }
}
```

### Provider - Runinng Contract as a test

Qontract leverages testing Frameworks to let you run contract as a test.
At the moment JUnit is supported. Each Scenario in translated to a junit test so that you get IDE support to run your contract.

Add a test class that extends "run.qontract.test.ContractAsATest". In the setUp method point to the location of the contract file and host and port of the provider.

```java
public class PetStoreContractTest extends QontractJUnitSupport {
    @BeforeAll
    public static void setUp() {
        File contract = new File("contract/service.contract");
        System.setProperty("path", contract.getAbsolutePath());
        System.setProperty("host", "localhost");
        System.setProperty("port", "port");
    }
}
```

Now all you have to do is make sure your provider app is running and then run your PetStoreContractTest just like any other JUnit test suite.
And results are displayed like JUnit tests.

You can also start and stop your application in the setUp and tearDown. Example: Here we are starting a Spring Provider Application.

```java
public class PetStoreContractTest extends QontractJUnitSupport {
    private static ConfigurableApplicationContext context;

    @BeforeAll
    public static void setUp() {
        File contract = new File("contract/service.contract");
        System.setProperty("path", contract.getAbsolutePath());
        System.setProperty("host", "localhost");
        System.setProperty("port", "8080");

        context = SpringApplication.run(Application.class);
    }

    @AfterAll
    public static void tearDown() {
        context.stop();
    }
}
```