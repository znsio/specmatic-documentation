{"id":1665,"date":"2023-07-18T10:10:27","date_gmt":"2023-07-18T04:40:27","guid":{"rendered":"https:\/\/specmatic.dvox.biz\/?p=1665"},"modified":"2023-08-14T10:19:03","modified_gmt":"2023-08-14T04:49:03","slug":"kafka-mocking-with-asyncapi-using-specmatic","status":"publish","type":"post","link":"https:\/\/specmatic.dvox.biz\/updates\/kafka-mocking-with-asyncapi-using-specmatic\/","title":{"rendered":"Kafka Mocking with AsyncAPI using Specmatic"},"content":{"rendered":"\n<figure class=\"wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio\"><div class=\"wp-block-embed__wrapper\">\n<div class=\"ast-oembed-container \" style=\"height: 100%;\"><iframe title=\"Kafka Mocking with AsyncAPI using Specmatic\" width=\"500\" height=\"281\" src=\"https:\/\/www.youtube.com\/embed\/kms69RLBhSc?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen><\/iframe><\/div>\n<\/div><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<h2 class=\"wp-block-heading\">Check out the sample code<\/h2>\n\n\n\n<p><strong>Sample project:&nbsp;<\/strong><a rel=\"noreferrer noopener\" href=\"https:\/\/github.com\/znsio\/specmatic-order-bff-nodejs\" target=\"_blank\">https:\/\/github.com\/znsio\/specmatic-order-bff-nodejs<\/a><br><strong>Download Specmatic:<\/strong>&nbsp;<a rel=\"noreferrer noopener\" href=\"https:\/\/github.com\/znsio\/specmatic\/releases\" target=\"_blank\">https:\/\/github.com\/znsio\/specmatic\/releases<\/a><\/p>\n\n\n\n<p><a href=\"https:\/\/specmatic.dvox.biz\/contact-us\/\" data-type=\"page\" data-id=\"475\">Contact us<\/a>\u00a0to join the private beta.<\/p>\n\n\n\n<p>In our previous post, we looked at how we can <a href=\"https:\/\/specmatic.in\/updates\/redis-stubbing-with-specmatic-contract-testing\">stub out redis with Specmatic<\/a> so that we can test our application independent of its dependency on Redis. In this post we will be looking at mocking Kafka with Specmatic by leveraging <a href=\"https:\/\/www.asyncapi.com\/\">AsyncAPI<\/a> specification.<\/p>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<h2 class=\"wp-block-heading\">Overview \u2013 how Specmatic can be used to mock Kafka using AsyncAPI<\/h2>\n\n\n\n<figure class=\"wp-block-image size-full\"><img fetchpriority=\"high\" decoding=\"async\" width=\"975\" height=\"720\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Specmatic-Kafka-Mocking-comp.gif\" alt=\"\" class=\"wp-image-1700\"\/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>Let&#8217;s take the example of an HTTP consumer that sends a request to an API application. The request is received by the controller, which invokes a service layer that fetches data from an HTTP API dependency, and then drops a message onto a Kafka topic. The service layer returns a response to the controller, which in turn returns a response to the consumer.<\/p>\n\n\n\n<p>To test this application independently, we need to isolate it from its http and Kafka dependencies. Specmatic can <a href=\"https:\/\/specmatic.in\/documentation\/service_virtualization_tutorial.html\">stub Http API dependencies by leveraging their OpenAPI specifications<\/a>. For asynchronous interactions such as those over Kafka, Specmatic can leverage <a href=\"https:\/\/www.asyncapi.com\/\">AsyncAPI specifications<\/a>.<\/p>\n\n\n\n<p style=\"padding-top:0;padding-right:0;padding-bottom:0;padding-left:0\">To isolate our application \/ system under test from its Kafka dependency, let us take an&nbsp; AsyncAPI specification that defines the format for messages on the Kafka topic and mock it out using Specmatic&#8217;s Kafka mock.<\/p>\n\n\n\n<div class=\"wp-block-kevinbatdorf-code-block-pro padding-bottom-disabled cbp-has-line-numbers cbp-highlight-hover\" data-code-block-pro-font-family=\"Code-Pro-JetBrains-Mono\" style=\"font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;--cbp-line-number-color:#adbac7;--cbp-line-number-width:14.4375px;--cbp-line-highlight-color:rgba(139, 186, 234, 0.2);line-height:1.25rem\"><span role=\"button\" tabindex=\"0\" data-code=\"asyncapi: 2.6.0\ninfo:\n  title: Product audits API\n  version: '1.0.0'\n\nservers:\n  kafka-dev:\n    url: tcp:\/\/localhost:61616\n    protocol: kafka\nchannels:\n  product-queries:\n    publish:\n      operationId: publishObjectMessage\n      message:\n        bindings:\n          kafka:\n            key:\n              type: string\n            bindingVersion: '0.4.0'\n        payload:\n          $ref: &quot;#\/components\/messages\/product&quot;\ncomponents:\n  messages:\n    product:\n      name: product\n      title: An inventory product\n      summary: Product representing items in inventory\n      contentType: application\/json\n      payload:\n        type: object\n        properties:\n          name:\n            description: Every product has a name\n            type: string\n          inventory:\n            description: Count of items in inventory\n            type: integer\n          id:\n            description: Unique indentifier of the product\n            type: integer\n          categories:\n            description: A list of product categories\n            type: array\n            items:\n              $ref: &quot;#\/components\/schemas\/category&quot;\n  schemas:\n    category:\n      type: object\n      properties:\n        id:\n           description: The id of the category\n           type: integer\n        name:\n          description: The name of the category\n          type: string\" style=\"color:#adbac7;display:none\" aria-label=\"Copy\" class=\"code-block-pro-copy-button\"><svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" style=\"width:24px;height:24px\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\"><path class=\"with-check\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4\"><\/path><path class=\"without-check\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"><\/path><\/svg><\/span><pre class=\"shiki github-dark-dimmed\" style=\"background-color: #22272e\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #8DDB8C\">asyncapi<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #6CB6FF\">2.6.0<\/span><\/span>\n<span class=\"line\"><span style=\"color: #8DDB8C\">info<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">  <\/span><span style=\"color: #8DDB8C\">title<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">Product audits API<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">  <\/span><span style=\"color: #8DDB8C\">version<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">&#39;1.0.0&#39;<\/span><\/span>\n<span class=\"line\"><\/span>\n<span class=\"line\"><span style=\"color: #8DDB8C\">servers<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">  <\/span><span style=\"color: #8DDB8C\">kafka-dev<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">    <\/span><span style=\"color: #8DDB8C\">url<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">tcp:\/\/localhost:61616<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">    <\/span><span style=\"color: #8DDB8C\">protocol<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">kafka<\/span><\/span>\n<span class=\"line\"><span style=\"color: #8DDB8C\">channels<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">  <\/span><span style=\"color: #8DDB8C\">product-queries<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">    <\/span><span style=\"color: #8DDB8C\">publish<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">operationId<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">publishObjectMessage<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">message<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">        <\/span><span style=\"color: #8DDB8C\">bindings<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">kafka<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">key<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">              <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">string<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">bindingVersion<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">&#39;0.4.0&#39;<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">        <\/span><span style=\"color: #8DDB8C\">payload<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">$ref<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">&quot;#\/components\/messages\/product&quot;<\/span><\/span>\n<span class=\"line\"><span style=\"color: #8DDB8C\">components<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">  <\/span><span style=\"color: #8DDB8C\">messages<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">    <\/span><span style=\"color: #8DDB8C\">product<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">name<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">product<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">title<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">An inventory product<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">summary<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">Product representing items in inventory<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">contentType<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">application\/json<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">payload<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">        <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">object<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">        <\/span><span style=\"color: #8DDB8C\">properties<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">name<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">description<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">Every product has a name<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">string<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">inventory<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">description<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">Count of items in inventory<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">integer<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">id<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">description<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">Unique indentifier of the product<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">integer<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">categories<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">description<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">A list of product categories<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">array<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">            <\/span><span style=\"color: #8DDB8C\">items<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">              <\/span><span style=\"color: #8DDB8C\">$ref<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">&quot;#\/components\/schemas\/category&quot;<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">  <\/span><span style=\"color: #8DDB8C\">schemas<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">    <\/span><span style=\"color: #8DDB8C\">category<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">object<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">      <\/span><span style=\"color: #8DDB8C\">properties<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">        <\/span><span style=\"color: #8DDB8C\">id<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">           <\/span><span style=\"color: #8DDB8C\">description<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">The id of the category<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">           <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">integer<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">        <\/span><span style=\"color: #8DDB8C\">name<\/span><span style=\"color: #ADBAC7\">:<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">description<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">The name of the category<\/span><\/span>\n<span class=\"line\"><span style=\"color: #ADBAC7\">          <\/span><span style=\"color: #8DDB8C\">type<\/span><span style=\"color: #ADBAC7\">: <\/span><span style=\"color: #96D0FF\">string<\/span><\/span><\/code><\/pre><span style=\"display:flex;align-items:flex-end;padding:10px;width:100%;justify-content:flex-start;background-color:#22272e;color:#9eadbd;font-size:12px;line-height:1;position:relative\">YAML<\/span><\/div>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>Let&#8217;s say we also use Specmatic to run contract tests against the application. First, we must set expectations on&nbsp; the Kafka mock about messages that it will receive. Then we must set expectations (response mappings) on Specmatic HTTP stub that is leveraging the OpenAPI specification of the HTTP dependency (Domain Service in the diagram above). You can learn more about contract testing and HTTP stubbing with Specmatic in <a href=\"https:\/\/www.youtube.com\/playlist?list=PL9Z-JgiTsOYRERcsy9o3y6nsi5yK3IB_w\" target=\"_blank\" rel=\"noreferrer noopener\">other videos<\/a>. Finally, Specmatic uses the application&#8217;s OpenAPI specification to run contract tests against it.<\/p>\n\n\n\n<p>Each contract test sends a request to the application which is received by the controller which in turn invokes the service layer. The service layer fetches data from the HTTP service stub and drops a message onto the topic on the Kafka mock. The Kafka mock uses an in memory Kafka broker, so the service layer sends messages to it seamlessly. Because of this, to the application it will be exactly like sending messages to a real Kafka broker in production. The service layer responds to the controller, which in turn responds to the contract test. After the contract tests have run, Specmatic asks the Kafka mock to verify the messages that it received. Let&#8217;s see this in an actual example.<\/p>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<h3 class=\"wp-block-heading\">Code walkthrough: <strong>Contract Test demonstrating Specmatic Kafka mock in action<\/strong><\/h3>\n\n\n\n<p>Here&#8217;s an application that fetches data from an HTTP API and writes a message to a Kafka broker.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img decoding=\"async\" width=\"1024\" height=\"633\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka1-1024x633.jpg\" alt=\"\" class=\"wp-image-1680\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka1-1024x633.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka1-300x185.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka1-768x474.jpg 768w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka1-1536x949.jpg 1536w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka1.jpg 1732w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>Here is a specmatic.json, in which we provide the path to AsyncAPI specification file for mocking out the Kafka dependency, the OpenAPI specification for stubbing out the HTTP dependency which the application needs, and the OpenAPI specification of the application itself which Specmatic will use to run contract tests.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img decoding=\"async\" width=\"1024\" height=\"496\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka2-specmatic-json-1024x496.jpg\" alt=\"\" class=\"wp-image-1681\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka2-specmatic-json-1024x496.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka2-specmatic-json-300x145.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka2-specmatic-json-768x372.jpg 768w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka2-specmatic-json-1536x744.jpg 1536w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka2-specmatic-json.jpg 1731w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>Now, let&#8217;s run the contract tests.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"768\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka3-coverage-summary-1024x768.jpg\" alt=\"\" class=\"wp-image-1682\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka3-coverage-summary-1024x768.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka3-coverage-summary-300x225.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka3-coverage-summary-768x576.jpg 768w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka3-coverage-summary.jpg 1420w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>In the API coverage summary for the above test, we have a contract test for one of the APIs, but not for the other, and so it&#8217;s marked as missed.<\/p>\n\n\n\n<p>Let&#8217;s look at how the Kafka expectations are being set and verified.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"587\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka4-expectations-1024x587.jpg\" alt=\"\" class=\"wp-image-1683\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka4-expectations-1024x587.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka4-expectations-300x172.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka4-expectations-768x440.jpg 768w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka4-expectations-1536x880.jpg 1536w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka4-expectations.jpg 1734w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>After starting the Specmatic Kafka mock, we set an expectation that it would receive a single message on the <strong>\u201cproduct queries\u201d<\/strong> topic. When the test runs, any messages received on this topic are validated against the product queries schema in the AsyncAPI specification. Finally, we verify the kafka mock. This checks if, as per expectations, the mock has received a single message at the product queries topic, and if that message adhered to the AsyncAPI specification. If either of these conditions are not met, or say if a topic that has not been captured in the AsyncAPI specification received a message, the verification fails. The message verification process lets the test keep a tight rein on all Kafka messages sent by the application.<\/p>\n\n\n\n<h3 class=\"wp-block-heading\"><strong>Code walkthrough: API Test demonstrating Specmatic Kafka mock in action<\/strong><\/h3>\n\n\n\n<p>The setup for API tests is on similar lines to the Specmatic contract tests. Let&#8217;s take a quick look at the test set up.<\/p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"492\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka6-1024x492.jpg\" alt=\"\" class=\"wp-image-1684\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka6-1024x492.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka6-300x144.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka6-768x369.jpg 768w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka6-1536x738.jpg 1536w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/kafka6.jpg 1772w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>Like with the contract tests, we start a Kafka mock, and then we set an expectation that a single message is expected on the product queries topic. Then in the test, we verify that the required message has indeed been received, and this line will verify that only one message on the product queries topic has been received as defined by the expectation set earlier on.<\/p>\n\n\n\n<p>Since the <strong>Specmatic Kafka mock is wire compatible<\/strong> and entirely within the control of the test, the test can run locally and in CI and deliver quick feedback early in the cycle. So the application itself runs exactly as it would with a real Kafka.<\/p>\n\n\n\n<p><strong>Sample project:\u00a0<\/strong><a rel=\"noreferrer noopener\" href=\"https:\/\/github.com\/znsio\/specmatic-order-bff-nodejs\" target=\"_blank\">https:\/\/github.com\/znsio\/specmatic-order-bff-nodejs<\/a><br><strong>Download Specmatic:<\/strong>\u00a0<a rel=\"noreferrer noopener\" href=\"https:\/\/github.com\/znsio\/specmatic\/releases\" target=\"_blank\">https:\/\/github.com\/znsio\/specmatic\/releases<\/a><\/p>\n\n\n\n<p><a href=\"https:\/\/specmatic.dvox.biz\/contact-us\/\">Contact us<\/a>\u00a0to join the private beta.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>The Specmatic Kafka mock is wire compatible and entirely within the control of the test, the test can run locally and in CI and deliver quick feedback early in the cycle. So the application itself runs exactly as it would with a real Kafka.<\/p>\n","protected":false},"author":5,"featured_media":1666,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"video","meta":{"_seopress_robots_primary_cat":"","_seopress_titles_title":"","_seopress_titles_desc":"","_seopress_robots_index":"","_uag_custom_page_level_css":"","site-sidebar-layout":"default","site-content-layout":"","ast-site-content-layout":"","site-content-style":"default","site-sidebar-style":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"disabled","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","astra-migrate-meta-layouts":"default","ast-page-background-enabled":"default","ast-page-background-meta":{"desktop":{"background-color":"var(--ast-global-color-4)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"ast-content-background-meta":{"desktop":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"footnotes":""},"categories":[58,14],"tags":[61,20,19,62,28],"uagb_featured_image_src":{"full":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/specmatickafka-mocking.jpg",1400,788,false],"thumbnail":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/specmatickafka-mocking-150x150.jpg",150,150,true],"medium":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/specmatickafka-mocking-300x169.jpg",300,169,true],"medium_large":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/specmatickafka-mocking-768x432.jpg",768,432,true],"large":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/specmatickafka-mocking-1024x576.jpg",1024,576,true],"1536x1536":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/specmatickafka-mocking.jpg",1400,788,false],"2048x2048":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/specmatickafka-mocking.jpg",1400,788,false]},"uagb_author_info":{"display_name":"Joel Rosario","author_link":"https:\/\/specmatic.dvox.biz\/author\/joel\/"},"uagb_comment_info":0,"uagb_excerpt":"The Specmatic Kafka mock is wire compatible and entirely within the control of the test, the test can run locally and in CI and deliver quick feedback early in the cycle. So the application itself runs exactly as it would with a real Kafka.","_links":{"self":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts\/1665"}],"collection":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/comments?post=1665"}],"version-history":[{"count":22,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts\/1665\/revisions"}],"predecessor-version":[{"id":1776,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts\/1665\/revisions\/1776"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/media\/1666"}],"wp:attachment":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/media?parent=1665"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/categories?post=1665"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/tags?post=1665"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}